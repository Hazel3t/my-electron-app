name: UAT Stage

on:
  workflow_dispatch:
    inputs:
      run_id:
        description: "The id of the workflow run where the desired download artifact was uploaded from."
        required: true
        type: number

permissions: write-all

jobs:
  uat:
    name: UAT Stage
    env:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    runs-on: macos-latest
    steps:
      - name: Checkout Test Repository
        uses: actions/checkout@v4
        with:
          repository: "vaisakhsasikumar/electron-app-tests"

      #   - name: Use Node.js
      #     uses: actions/setup-node@v4
      #     with:
      #       node-version: 20

      #   - name: Install dependencies
      #     run: npm ci

      - uses: actions/download-artifact@v4
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          run-id: ${{ github.event.inputs.run_id }}

      #   - name: Install MongoDB
      #     run: |
      #       echo "Installing MongoDB..."
      #       brew tap mongodb/brew
      #       brew install mongodb-community@6.0

      #   - name: Start MongoDB
      #     run: |
      #       echo "Starting MongoDB..."
      #       brew services start mongodb/brew/mongodb-community@6.0
      #       echo "Waiting for MongoDB to be ready..."
      #       until nc -z localhost 27017; do
      #         echo "MongoDB is not ready yet, retrying in 5 seconds..."
      #         sleep 5
      #       done

      #   - name: Create test database and collection
      #     run: |
      #       echo "Creating test database and collection..."
      #       mongosh <<EOF
      #       use test
      #       db.test.insertMany([
      #         { name: "test1", value: 1 },
      #         { name: "test2", value: 2 },
      #         { name: "test3", value: 3 }
      #       ])
      #       EOF

      #   - name: Set Permissions
      #     run: chmod 755 pipeline.sh

      #   - name: Run pipeline.sh
      #     run: ./pipeline.sh

      #   - name: Run Smoke Tests
      #     run: npm run test:smoke

      #   - name: Stop MongoDB
      #     run: |
      #       echo "Stop MongoDB..."
      #       brew services stop mongodb-community@6.0

      - name: Release
        uses: softprops/action-gh-release@v2
        with:
          draft: true
          files: $(find . -type f -name "*.dmg" -print -quit)
